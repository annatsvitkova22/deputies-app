<div class="modal modal-body container">
    <app-loader *ngIf="isLoader" [class]="'loader-animation'" ></app-loader>
    <div [class.d-none]='isLoader' class="modal__wrapper">
        <div class="d-flex justify-content-between align-items-center modal__main">
            <div>
                <div class="d-flex align-items-center">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path fillRule="evenodd" clipRule="evenodd" d="M7.14961 2.29172C7.14961 1.79467 6.74667 1.39172 6.24961 1.39172C5.75255 1.39172 5.34961 1.79467 5.34961 2.29172V3.26957C3.26521 3.3484 1.59961 5.06306 1.59961 7.16674V14.5001C1.59961 16.654 3.3457 18.4001 5.49961 18.4001H14.4996C16.6535 18.4001 18.3996 16.654 18.3996 14.5001V7.16674C18.3996 5.06306 16.734 3.3484 14.6496 3.26957V2.29172C14.6496 1.79467 14.2467 1.39172 13.7496 1.39172C13.2526 1.39172 12.8496 1.79467 12.8496 2.29172V3.26674H7.14961V2.29172ZM3.39961 14.5001V7.50008H16.5996V14.5001C16.5996 15.6599 15.6594 16.6001 14.4996 16.6001H5.49961C4.33981 16.6001 3.39961 15.6599 3.39961 14.5001ZM5.62461 8.68339C5.12755 8.68339 4.72461 9.08633 4.72461 9.58339C4.72461 10.0804 5.12755 10.4834 5.62461 10.4834H6.87461C7.37167 10.4834 7.77461 10.0804 7.77461 9.58339C7.77461 9.08633 7.37167 8.68339 6.87461 8.68339H5.62461ZM9.37461 8.68339C8.87755 8.68339 8.47461 9.08633 8.47461 9.58339C8.47461 10.0804 8.87755 10.4834 9.37461 10.4834H10.6246C11.1217 10.4834 11.5246 10.0804 11.5246 9.58339C11.5246 9.08633 11.1217 8.68339 10.6246 8.68339H9.37461ZM13.1246 8.68339C12.6276 8.68339 12.2246 9.08633 12.2246 9.58339C12.2246 10.0804 12.6276 10.4834 13.1246 10.4834H14.3746C14.8717 10.4834 15.2746 10.0804 15.2746 9.58339C15.2746 9.08633 14.8717 8.68339 14.3746 8.68339H13.1246ZM5.62461 11.1834C5.12755 11.1834 4.72461 11.5863 4.72461 12.0834C4.72461 12.5804 5.12755 12.9834 5.62461 12.9834H6.87461C7.37167 12.9834 7.77461 12.5804 7.77461 12.0834C7.77461 11.5863 7.37167 11.1834 6.87461 11.1834H5.62461ZM9.37461 11.1834C8.87755 11.1834 8.47461 11.5863 8.47461 12.0834C8.47461 12.5804 8.87755 12.9834 9.37461 12.9834H10.6246C11.1217 12.9834 11.5246 12.5804 11.5246 12.0834C11.5246 11.5863 11.1217 11.1834 10.6246 11.1834H9.37461ZM13.1246 11.1834C12.6276 11.1834 12.2246 11.5863 12.2246 12.0834C12.2246 12.5804 12.6276 12.9834 13.1246 12.9834H14.3746C14.8717 12.9834 15.2746 12.5804 15.2746 12.0834C15.2746 11.5863 14.8717 11.1834 14.3746 11.1834H13.1246ZM5.62461 13.6834C5.12755 13.6834 4.72461 14.0863 4.72461 14.5834C4.72461 15.0804 5.12755 15.4834 5.62461 15.4834H6.87461C7.37167 15.4834 7.77461 15.0804 7.77461 14.5834C7.77461 14.0863 7.37167 13.6834 6.87461 13.6834H5.62461ZM9.37461 13.6834C8.87755 13.6834 8.47461 14.0863 8.47461 14.5834C8.47461 15.0804 8.87755 15.4834 9.37461 15.4834H10.6246C11.1217 15.4834 11.5246 15.0804 11.5246 14.5834C11.5246 14.0863 11.1217 13.6834 10.6246 13.6834H9.37461ZM13.1246 13.6834C12.6276 13.6834 12.2246 14.0863 12.2246 14.5834C12.2246 15.0804 12.6276 15.4834 13.1246 15.4834H14.3746C14.8717 15.4834 15.2746 15.0804 15.2746 14.5834C15.2746 14.0863 14.8717 13.6834 14.3746 13.6834H13.1246Z" fill="#A6B1C4"/>
                    </svg>
                    <p class="modal__date">{{appeal.date}}</p>
                </div>
                <div class="modal__status-block mobile-block mt-10">
                    <p class="modal__status card__status tx-blue font-weight-600" [ngClass]="statusColor">{{appeal.status}}</p>
                </div>
            </div>
            <button class="modal__close" (click)="onClose()">
                <span></span>
                <span></span>
            </button>
        </div>
        <div class="w-100 mt-16 d-flex justify-content-between">
            <div class="modal__left-section">
                <h2 class="modal__title">{{appeal.title}}</h2>
                <div class="modal__users">
                    <h6 class="title-small mb-10">Автор</h6>
                    <div class="modal__person d-flex align-items-center">
                        <app-avatar [imageUrl]="appeal.userImageUrl" [name]="appeal.shortNameUser" [class]="'avatar__extra-small'"></app-avatar>
                        <p class="author-name ml-8">{{appeal.userName}}</p>
                    </div>
                    <h6 class="title-small mb-10">Відповідальний</h6>
                    <div class="modal__person d-flex">
                        <app-avatar [imageUrl]="appeal.deputyImageUrl" [name]="appeal.shortName" [class]="'avatar__extra-small'"></app-avatar>
                        <div class="modal__deputy ml-8">
                            <p class="author-name">{{appeal.deputyName}}</p>
                            <p class="party-name font-weight-500 tx-small">{{appeal.party}}</p>
                        </div>
                    </div>
                    <div *ngIf="isDeputy && appeal.status !== 'Виконано' && isButton" class="mt-14 d-flex modal__buttons">
                        <button (click)="onWork(appeal.id, appeal.status)" class="mb-12 btn btn-green">{{textButton}}</button>
                        <button *ngIf="appeal.status === 'До виконання'" (click)="onComplain(appeal.id)"  class="btn">Поскаржитися</button>
                    </div>
                    <div *ngIf="appeal.location" class="map" #smallMap></div>
                </div>
                <div class="mb-22">
                    <p class="modal__about mb-2">Опис</p>
                    <p class="modal__description line-height-168">{{appeal.description}}</p>
                </div>
                <div *ngIf="appeal.fileImageUrl && appeal.fileImageUrl.length">
                    <div class="mb-12 d-flex align-items-center">
                        <svg width="10" height="19" viewBox="0 0 10 19" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M8.33366 4.58333L8.33366 14.1667C8.33366 16.0083 6.84199 17.5 5.00033 17.5C3.15866 17.5 1.66699 16.0083 1.66699 14.1667L1.66699 3.75C1.66699 2.6 2.60033 1.66667 3.75033 1.66667C4.90033 1.66667 5.83366 2.6 5.83366 3.75L5.83366 12.5C5.83366 12.9583 5.45866 13.3333 5.00033 13.3333C4.54199 13.3333 4.16699 12.9583 4.16699 12.5L4.16699 4.58333L2.91699 4.58333L2.91699 12.5C2.91699 13.65 3.85033 14.5833 5.00033 14.5833C6.15033 14.5833 7.08366 13.65 7.08366 12.5L7.08366 3.75C7.08366 1.90833 5.59199 0.416668 3.75033 0.416668C1.90866 0.416668 0.416991 1.90833 0.416992 3.75L0.416992 14.1667C0.416992 16.7 2.46699 18.75 5.00033 18.75C7.53366 18.75 9.58366 16.7 9.58366 14.1667L9.58366 4.58333L8.33366 4.58333Z" fill="#404957"/>
                        </svg>
                        <p class="modal__about ml-14">Прикріплені матеріали</p>
                    </div>
                    <div slickContainer #slickController="slick" [slickConfig]="config">
                        <ng-container >
                        <a  
                            slickItem
                            *ngFor="let fileImageUrl of appeal.fileImageUrl; let i = index"
                            [href]="appeal.fileUrl[i]"
                            download
                            target="_blank"
                            class="modal__file"
                            [ngStyle]="{backgroundImage: 'url(' + fileImageUrl + ')'}"
                        >
                        </a>
                        </ng-container>
                    </div>
                </div>
                <div class="d-flex justify-content-between align-items-center">
                    <div class="d-flex align-items-center">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path fillRule="evenodd" clipRule="evenodd" d="M18.1823 9.7417C17.3773 13.4414 13.4608 16.2486 8.75047 16.2486C8.071 16.2486 7.40804 16.1902 6.76855 16.0791C8.06654 17.205 9.9667 17.9153 12.0838 17.9153C13.2485 17.9153 14.3476 17.7003 15.3168 17.3194C15.7627 17.1442 17.1941 17.5995 18.1801 17.9554C18.5772 18.0987 18.9878 17.723 18.8818 17.3144C18.6365 16.3686 18.3525 15.0534 18.5611 14.6942C18.9507 14.0231 19.1671 13.2802 19.1671 12.4986C19.1671 11.4919 18.808 10.5493 18.1823 9.7417Z" fill="#2F3640"/>
                            <path d="M16.6663 8.33325C16.6663 11.785 13.1219 14.5833 8.74967 14.5833C7.55886 14.5833 6.42946 14.3757 5.41634 14.0039C4.90354 13.8157 3.03905 14.3206 1.85196 14.6784C1.44576 14.8009 1.059 14.3962 1.19313 13.9937C1.52653 12.9933 1.93343 11.5487 1.66634 11.1275C1.13309 10.2867 0.833008 9.33762 0.833008 8.33325C0.833008 4.88147 4.37742 2.08325 8.74967 2.08325C13.1219 2.08325 16.6663 4.88147 16.6663 8.33325Z" fill="#2F3640"/>
                        </svg>
                        <p class="modal__discus">Обговорення запиту</p>
                    </div>
                    <div>
                        <button class="modal__button" (click)="onHidden()">
                            Приховати
                            <svg [class.modal__arrow--down]="!isHidden" class="modal__arrow" width="12" height="7" viewBox="0 0 12 7" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M1 6L6 1L11 6" stroke="#404957" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <div *ngIf="isWriteComment" class="modal__comment-section mt-12 mb-20 d-flex align-items-center">
                    <app-avatar [imageUrl]="userAvatal.imageUrl" [name]="userAvatal.shortName"></app-avatar>
                    <textarea
                        class="input textarea modal__comment"
                        placeholder="Написати комментар..."
                        [(ngModel)] = "comment"
                        name="comment"
                    >
                    </textarea>
                    <svg class="modal__comment-btn" (click)="sendComment()" width="34" height="34" viewBox="0 0 34 34" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect width="34" height="34" rx="17" fill="#5BCF0C"/>
                        <path d="M12 15L17 10M17 10L22 15M17 10V24" stroke="white" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
                <div *ngIf="comments.length && isHidden" class="mt-12 modal__com">
                    <div *ngFor="let oneComment of comments" class="mb-20 d-flex">
                        <app-avatar [imageUrl]="oneComment.imageUrl" [name]="oneComment.shortName"></app-avatar>
                        <div class="modal__space">
                            <div class="modal__comments" [class.modal__comments--active]="oneComment.isBackground">
                                <p class="modal__comments-title">{{oneComment.autorName}}</p>
                                <div *ngIf="oneComment.type == 'feedback'" class="d-flex align-items-center">
                                    <ngb-rating [(rate)]="oneComment.rating">
                                        <ng-template let-fill="fill" let-index="index">
                                            <span class="star" [class.filled]="fill === 100">&#9733;</span>
                                        </ng-template>
                                    </ngb-rating>
                                    <p class="tx-small tx-color-10 font-weight-500">{{oneComment.rating + '.0'}}</p>
                                </div>
                                <p class="mt-6 mb-8 line-height-146">{{oneComment.message}}</p>
                                <p class="modal__comments-date">{{oneComment.date}}</p>
                            </div>
                            <div *ngIf="oneComment.type == 'done'" class="modal__comment-done">
                                <div class="d-flex align-items-center">
                                    <div class="modal__status-block status-work status">
                                        <p class="modal__status card__status tx-blue font-weight-600">В роботі</p>
                                    </div>
                                    <svg width="14" height="8" viewBox="0 0 14 8" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path fillRule="evenodd" clipRule="evenodd" d="M10.6402 7.43743L13.7348 4.34277C13.8813 4.19634 13.8813 3.9589 13.7348 3.81243L10.6402 0.717773C10.4039 0.481523 10 0.648836 10 0.98293V3.20262H0.375C0.167906 3.20262 0 3.37052 0 3.57762V4.57762C0 4.78471 0.167906 4.95262 0.375 4.95262H10V7.1723C10 7.50634 10.4039 7.67365 10.6402 7.43743Z" fill="#404957"/>
                                    </svg>
                                    <div class="modal__status-block status-done status">
                                        <p class="modal__status card__status tx-blue font-weight-600 card__status--green">Виконано</p>
                                    </div>
                                </div>
                                <p class="modal__comments-date mt-6">{{oneComment.date}}</p>
                            </div>
                        </div>
                    </div>
                </div>
                <fb-comments href="{{url}}" width="100%" height="300"></fb-comments>
            </div>
            <div class="modal__right-section">
                <div class="modal__status-block">
                    <p class="modal__status card__status tx-blue font-weight-600" [ngClass]="statusColor">{{appeal.status}}</p>
                </div>
                <h6 class="title-small mb-10">Автор</h6>
                <div class="modal__person d-flex align-items-center">
                    <app-avatar [imageUrl]="appeal.userImageUrl" [name]="appeal.shortNameUser" [class]="'avatar__extra-small'"></app-avatar>
                    <p class="author-name ml-8">{{appeal.userName}}</p>
                </div>
                <h6 class="title-small mb-10">Відповідальний</h6>
                <div class="modal__person d-flex">
                    <app-avatar [imageUrl]="appeal.deputyImageUrl" [name]="appeal.shortName" [class]="'avatar__extra-small'"></app-avatar>
                    <div class="modal__deputy ml-8">
                        <p class="author-name">{{appeal.deputyName}}</p>
                        <p class="party-name font-weight-500 tx-small">{{appeal.party}}</p>
                    </div>
                </div>
                <div *ngIf="isDeputy && appeal.status !== 'Виконано' && isButton" class="mt-14 d-flex modal__buttons">
                    <button *ngIf="!isBlockAppeal && !isLoaderBlock" (click)="onWork(appeal.id, appeal.status)" class="mb-12 btn btn-green">{{textButton}}</button>
                    <button *ngIf="appeal.status === 'До виконання' && !isBlockAppeal && !isLoaderBlock" (click)="onComplain(appeal.id)"  class="btn">Поскаржитися</button>
                    <app-loader *ngIf="isLoaderBlock" [class]="'mb-30 loader-medium'" ></app-loader>
                </div>
                <div *ngIf="appeal.location" class="map" #map></div>
            </div>
        </div>
    </div>
</div>
